"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var index_1 = require("./index");
var t = new index_1.Toolbox();
var d = t.addMomentToDate(new Date(), 'minute', -30);
var moment = require('moment');
var d = moment();
var f = d.format("L LTS");
var s = t.beautifyJson('{"a1": "0", "a2": "2"}');
console.log(s);
var tr = [{
        "key": "Bonjour",
        "values": [
            {
                "language": "EN",
                "value": "Hello"
            },
            {
                "language": "ES",
                "value": "Hol√†"
            }
        ]
    },
    {
        "key": "Au revoir",
        "values": [
            {
                "language": "EN",
                "value": "Good bye"
            },
            {
                "language": "ES",
                "value": "Adios"
            }
        ]
    }];
var ttt = t.translateFromObject(tr, "Bonjour", "EN");
var ttt1 = t.translateFromObject(tr, "Au revoir", "ES");
var ttttt = t.translateFromFile("Bonjour", "EN", "./trans.json");
var xml = "<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\n<prescription>\n    <patient>\n        <dateOfBirth>1980-10-26T01:01:01</dateOfBirth>\n        <gender>MALE</gender>\n        <!-- MALE FEMALE NONE -->\n        <weight>80</weight>\n        <!-- kg -->\n        <height>180</height>\n        <!-- cm -->\n        <breastFeeding>NONE</breastFeeding>\n        <!-- NONE LESS_THAN_ONE_MONTH MORE_THAN_ONE_MONTH ALL (if no information available) -->\n        <creatin>80</creatin>\n        <!-- ml/min -->\n        <hepaticInsufficiency>NONE</hepaticInsufficiency>\n        <!-- NONE MODERATE SEVERE -->\n        <weeksOfAmenorrhea>1</weeksOfAmenorrhea>\n        <allergies>\n            <!-- use /rest/api/allergies?q=xxx -->\n            <allergy>vidal://allergy/635</allergy>\n        </allergies>\n        <molecules>\n            <!-- use /rest/api/allergies?q=xxx -->\n            <molecule>vidal://molecule/309</molecule>\n        </molecules>\n        <pathologies>\n            <!-- /rest/api/pathologies?q=xxx&type=CIM10 -->\n            <pathology>vidal://cim10/4398</pathology>\n            <!-- vidal://cim10/idXXX -->\n            <pathology>vidal://cim10/code/J45</pathology>\n            <!-- vidal://cim10/code/XXX -->\n        </pathologies>\n    </patient>\n    <prescription-lines>\n        <prescription-line>\n            <drugId>12759</drugId>\n            <drugType>COMMON_NAME_GROUP</drugType>\n            <!--COMMON_NAME_GROUP PRODUCT PACK UCD -->\n            <dose>2.000</dose>\n            <unitId>129</unitId>\n            <duration>3</duration>\n            <durationType>DAY</durationType>\n            <!-- MINUTE HOUR DAY WEEK MONTH YEAR -->\n            <frequencyType>PER_DAY</frequencyType>\n            <!-- THIS_DAY PER_DAY PER_24_HOURS PER_WEEK PER_MONTH PER_YEAR PER_2_DAYS PER_HOUR PER_MINUTE -->\n        </prescription-line>\n        <prescription-line>\n            <drug>vidal://package/41929</drug>\n            <!-- vidal://package/idXXXX vidal://product/idXXX vidal://vmp/idXXX vidal://ucd/idXXX-->\n            <dose>2.000</dose>\n            <unitId>35</unitId>\n            <duration>2</duration>\n            <durationType>DAY</durationType>\n            <frequencyType>PER_DAY</frequencyType>\n            <routes>\n                <!-- use /rest/api/routes?q=xxx -->\n                <route>vidal://route/38</route>\n                <route>vidal://route/14</route>\n            </routes>\n        </prescription-line>\n        <prescription-line>\n            <drugId>1037</drugId>\n            <drugType>PRODUCT</drugType>\n            <dose>2</dose>\n            <unitId>129</unitId>\n            <duration>5</duration>\n            <durationType>DAY</durationType>\n            <frequencyType>PER_DAY</frequencyType>\n            <routes>\n                <route>vidal://route/38</route>\n            </routes>\n        </prescription-line>\n        <prescription-line>\n            <drug>vidal://ucd/ucd13/3400892676739</drug>\n            <!-- vidal://cip7/XXXX vidal://cip13/XXX vidal://ucd13/XXX vidal://cis/XXX -->\n            <dose>2</dose>\n            <unitId>129</unitId>\n            <duration>5</duration>\n            <durationType>DAY</durationType>\n            <frequencyType>PER_DAY</frequencyType>\n            <routes>\n                <route>vidal://route/38</route>\n            </routes>\n        </prescription-line>\n    </prescription-lines>\n</prescription>";
var callback = function (json) {
    console.log(JSON.stringify(json));
};
// var ret = t.xml2json(xml, callback);
// t.log(ret, 'log.txt');
var r = new index_1.Rest();
var body = "<?xml version='1.0' encoding='UTF-8' standalone='yes'?><prescription><patient><dateOfBirth>1980-12-25T00:00:00</dateOfBirth><gender>FEMALE</gender><weight>55</weight><height>111</height><breastFeeding>NONE</breastFeeding><hepaticInsufficiency>NONE</hepaticInsufficiency><allergies><allergy>vidal://allergy/729</allergy></allergies><molecules><molecule>vidal://molecule/420</molecule><molecule>vidal://molecule/3295</molecule></molecules><pathologies><pathology>vidal://cim10/2720</pathology><pathology>vidal://cim10/2668</pathology><pathology>vidal://cim10/2640</pathology></pathologies></patient><prescription-lines><prescription-line><drug>vidal://vmp/2508</drug><dose>1</dose><unitId>129</unitId><duration>1</duration><durationType>MONTH</durationType><frequencyType>PER_DAY</frequencyType><routes><route>vidal://route/38</route></routes></prescription-line><prescription-line><drug>vidal://vmp/2675</drug><dose>1</dose><unitId>60</unitId><duration>1</duration><durationType>MONTH</durationType><frequencyType>PER_DAY</frequencyType><routes><route>vidal://route/38</route></routes></prescription-line><prescription-line><drug>vidal://product/15070</drug><dose>1</dose><unitId>129</unitId><duration>1</duration><durationType>MONTH</durationType><frequencyType>PER_DAY</frequencyType><routes><route>vidal://route/38</route></routes></prescription-line><prescription-line><drug>vidal://vmp/1533</drug><dose>12</dose><unitId>129</unitId><duration>1</duration><durationType>MONTH</durationType><frequencyType>PER_DAY</frequencyType><routes><route>vidal://route/38</route></routes></prescription-line><prescription-line><drug>vidal://product/4882</drug><dose>1</dose><unitId>129</unitId><duration>1</duration><durationType>MONTH</durationType><frequencyType>PER_DAY</frequencyType><routes><route>vidal://route/38</route></routes></prescription-line><prescription-line><drug>vidal://product/4002</drug><dose>1</dose><unitId>129</unitId><duration>1</duration><durationType>MONTH</durationType><frequencyType>PER_DAY</frequencyType><routes><route>vidal://route/38</route></routes></prescription-line></prescription-lines></prescription>";
r.call(function (data) { return callback(data); }, "GET", "http://api.vidal.fr/rest/api/version", null, "text/xml");
r.call(function (data) { return callback(data); }, "POST", "http://api.vidal.fr/rest/api/alerts/full?app_id=&app_key=", body, "text/xml");
var tes = JSON.parse("[\n    {\n        \"idprescribable\": 32815,\n        \"prescribableId\": 5,\n        \"code\": \"0000000000005\",\n        \"name\": \"Lactitol [IMPORTAL] BUV\",\n        \"hasKnownEffectExcipients\": 1,\n        \"isHomogeneousOnIndications\": 0,\n        \"hasSafetyAlert\": 1,\n        \"hasMultipleRoutes\": 1,\n        \"longName\": \"[IMPORTAL] LACTITOL ; TOUTES VOIES ; TOUTES FORMES ; TOUS DOSAGES\",\n        \"lastModificationTime\": \"0000-00-00 00:00:00\",\n        \"startDate\": \"2015-09-21T22:00:00.000Z\",\n        \"endDate\": \"0000-00-00 00:00:00\",\n        \"marketStatus\": 0,\n        \"idprescribableline\": 1,\n        \"iddrug\": 3140,\n        \"drugtype\": \"ucd\",\n        \"drugname\": \"IMPORTAL 10G BUV PDR SACH\",\n        \"startdate\": \"2011-10-19T22:00:00.000Z\",\n        \"enddate\": null,\n        \"data\": null\n    },\n    {\n        \"idprescribable\": 32815,\n        \"prescribableId\": 5,\n        \"code\": \"0000000000005\",\n        \"name\": \"Lactitol [IMPORTAL] BUV\",\n        \"hasKnownEffectExcipients\": 1,\n        \"isHomogeneousOnIndications\": 0,\n        \"hasSafetyAlert\": 1,\n        \"hasMultipleRoutes\": 1,\n        \"longName\": \"[IMPORTAL] LACTITOL ; TOUTES VOIES ; TOUTES FORMES ; TOUS DOSAGES\",\n        \"lastModificationTime\": \"0000-00-00 00:00:00\",\n        \"startDate\": \"2015-09-21T22:00:00.000Z\",\n        \"endDate\": \"0000-00-00 00:00:00\",\n        \"marketStatus\": 0,\n        \"idprescribableline\": 2,\n        \"iddrug\": 4039,\n        \"drugtype\": \"ucd\",\n        \"drugname\": \"IMPORTAL 5G BUV PDR SACH\",\n        \"startdate\": \"2011-10-19T22:00:00.000Z\",\n        \"enddate\": null,\n        \"data\": null\n    },\n    {\n        \"idprescribable\": 32815,\n        \"prescribableId\": 5,\n        \"code\": \"0000000000005\",\n        \"name\": \"Lactitol [IMPORTAL] BUV\",\n        \"hasKnownEffectExcipients\": 1,\n        \"isHomogeneousOnIndications\": 0,\n        \"hasSafetyAlert\": 1,\n        \"hasMultipleRoutes\": 1,\n        \"longName\": \"[IMPORTAL] LACTITOL ; TOUTES VOIES ; TOUTES FORMES ; TOUS DOSAGES\",\n        \"lastModificationTime\": \"0000-00-00 00:00:00\",\n        \"startDate\": \"2015-09-21T22:00:00.000Z\",\n        \"endDate\": \"0000-00-00 00:00:00\",\n        \"marketStatus\": 0,\n        \"idprescribableline\": 3,\n        \"iddrug\": 4040,\n        \"drugtype\": \"ucd\",\n        \"drugname\": \"IMPORTAL 2,5G BUV PDR SACH\",\n        \"startdate\": \"2011-10-19T22:00:00.000Z\",\n        \"enddate\": null,\n        \"data\": null\n    },\n    {\n        \"idprescribable\": 32833,\n        \"prescribableId\": 27,\n        \"code\": \"0000000000027\",\n        \"name\": \"Tipranavir [APTIVUS] BUV\",\n        \"hasKnownEffectExcipients\": 1,\n        \"isHomogeneousOnIndications\": 1,\n        \"hasSafetyAlert\": 1,\n        \"hasMultipleRoutes\": 0,\n        \"longName\": \"[APTIVUS] TIPRANAVIR ; ORALE ; SOL BUV ;  TOUS DOSAGES\",\n        \"lastModificationTime\": \"0000-00-00 00:00:00\",\n        \"startDate\": \"2013-10-21T22:00:00.000Z\",\n        \"endDate\": \"0000-00-00 00:00:00\",\n        \"marketStatus\": 0,\n        \"idprescribableline\": 4,\n        \"iddrug\": 15820,\n        \"drugtype\": \"ucd\",\n        \"drugname\": \"APTIVUS 100MG/ML BUV FL95ML\",\n        \"startdate\": \"2011-10-19T22:00:00.000Z\",\n        \"enddate\": null,\n        \"data\": null\n    },\n    {\n        \"idprescribable\": 32850,\n        \"prescribableId\": 47,\n        \"code\": \"0000000000047\",\n        \"name\": \"Amoxicilline 100mg/ml [AMODEX] BUV\",\n        \"hasKnownEffectExcipients\": 1,\n        \"isHomogeneousOnIndications\": 1,\n        \"hasSafetyAlert\": 1,\n        \"hasMultipleRoutes\": 0,\n        \"longName\": \"[AMODEX] AMOXICILLINE * 500 MG/5 ML ; VOIE ORALE ; PDRE P SUSP BUV\",\n        \"lastModificationTime\": \"0000-00-00 00:00:00\",\n        \"startDate\": \"2014-06-18T22:00:00.000Z\",\n        \"endDate\": \"0000-00-00 00:00:00\",\n        \"marketStatus\": 0,\n        \"idprescribableline\": 5,\n        \"iddrug\": 2122,\n        \"drugtype\": \"ucd\",\n        \"drugname\": \"AMODEX 500MG BUV PDR FL60ML\",\n        \"startdate\": \"2011-10-19T22:00:00.000Z\",\n        \"enddate\": null,\n        \"data\": null\n    }\n]\n");
console.log(t.factorizeMasterSlave(tes, "idprescribable", "idprescribableline", "lines"));
